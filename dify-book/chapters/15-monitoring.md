# 第 15 章：运营监控与优化——让应用越用越好

> 应用发布一周后，小林打开 Dify 后台看数据。
>
> AI 客服一周处理了 1200 多次对话，解决率 78%。
>
> *"78% 还行，但剩下 22% 是什么情况？"*
>
> 小林点进日志，翻了几条没有解决的对话，发现了问题：
>
> - 有个客户问"Can I pay with Klarna in 12 installments?"，AI 回答的是"We support Klarna"，但没说**只支持 4 期免息**
> - 有个客户问"Do you have any Black Friday deals?"，AI 说"这个问题我需要转给人工客服"——其实活动信息已经在知识库里了，只是检索没命中
>
> *"原来不是应用'做好了'就完事，还得持续看数据、找问题、改优化。"*
>
> 这就是运营监控的作用。

## 对话日志

Dify 会记录每一次用户和应用的交互。这是你了解应用表现的第一手数据。

### 查看日志

1. 打开你的应用
2. 点击左侧导航的「日志」（Logs）
3. 你会看到按时间排列的对话列表

每条日志包含：
- **用户输入**：用户问了什么
- **AI 回答**：应用输出了什么
- **元数据**：响应时间、Token 消耗、使用的模型
- **节点执行详情**（Workflow/Chatflow）：每个节点的输入输出

### 分析日志的关键维度

**1. 回答质量**

逐条检查 AI 的回答是否准确、完整。重点看：
- AI 说"需要转人工"的对话——这些可能是知识库缺失的内容
- 用户追问或重复提问的对话——说明第一次回答不够好
- 用户负面反馈的对话——如果开启了反馈功能

**2. 执行效率**

- 平均响应时间是否合理
- 哪些节点耗时最长（可能需要优化）
- Token 消耗是否在预期范围内

**3. 问题分布**

统计用户最常问的问题类型。如果某类问题特别多，说明：
- 这个领域的知识库需要加强
- 或者业务本身需要改进（比如退货流程太复杂导致咨询量大）

## 标注回复

小林在日志里发现，有些问题 AI 虽然回答了，但不够好。比如：

> 客户：Can I use Klarna to pay in 12 installments?
> AI：Yes, TechStore supports Klarna. You can select it at checkout.

这个回答有一个关键遗漏——没说 **Klarna 只支持 4 期免息，不支持 12 期**。客户可能会以为支持，结果结算时发现不行，就变成投诉了。

**标注回复（Annotation Reply）** 就是解决这个问题的。

### 什么是标注回复

标注回复让你可以为特定问题**预设标准答案**。当用户问的问题和标注足够相似时，系统**直接返回你预设的答案**，跳过 AI 生成。

好处：
- **精确控制**：关键问题的回答完全由你决定
- **避免幻觉**：AI 不会编造或遗漏信息
- **响应更快**：不需要调用 LLM，直接匹配返回
- **成本更低**：不消耗 Token

### 设置标注回复

**方式一：从日志中标注**

1. 在日志中找到回答不够好的对话
2. 点击 AI 回答旁边的「编辑」图标
3. 修改为你期望的标准答案
4. 点击「保存为标注」

比如，把上面那个 Klarna 分期的回答改为：

```
Yes, TechStore supports Klarna's "Pay in 4" option — you can split your purchase into 4 interest-free payments. However, we don't currently support 12-month installment plans. The exact terms will be shown at checkout.
```

**方式二：批量导入**

如果你有一批标准 Q&A，可以批量导入：

1. 进入「日志与标注」页面
2. 切换到「标注」标签
3. 点击「批量导入」
4. 下载模板，填写问题-答案对，上传

**方式三：手动添加**

在标注页面直接点「添加」，手动输入问题和标准答案。

### 配置匹配参数

1. 在应用的「编排」页面，找到「添加功能」
2. 开启「标注回复」
3. 配置：
   - **相似度阈值**：建议 0.9（高精度匹配）。阈值越高，匹配越严格，越不容易误触发
   - **Embedding 模型**：选择用于计算语义相似度的模型

### 监控标注效果

开启标注回复后，你可以在标注页面看到：
- 每条标注被命中的次数
- 命中时的相似度分数
- 最近的命中记录

这些数据帮助你判断：
- 哪些标注用得多（说明这个问题确实常见）
- 哪些标注从没命中（可能问题描述需要调整）
- 相似度分数是否合适（太低可能误匹配）

## 持续优化循环

小林把运营监控变成了一个周期性的流程：

```
发布应用
    ↓
查看日志（每周 1-2 次）
    ↓
发现问题
    ├── 知识库缺失 → 补充知识库内容
    ├── 回答不准确 → 添加标注回复
    ├── 流程不合理 → 调整 Workflow 节点
    └── 提示词不好 → 优化 Prompt
    ↓
重新发布
    ↓
继续监控效果
```

**第一周**：小林加了 15 条标注回复，覆盖了最常见的问题。

**第二周**：AI 客服解决率从 78% 提升到 85%。小林又补充了一批知识库内容。

**第三周**：解决率提升到 91%。客服组长说："现在只有真的复杂问题才需要转人工了。"

---

::: tip 小林的经验
1. **刚上线的第一周最重要**——集中精力看日志，快速迭代
2. **标注回复优先用在"关键问题"上**——比如价格、政策这类不能出错的信息
3. **不要追求 100% 自动化**——有些问题就是需要人工处理，AI 能做到 90% 已经很好
4. **每次大改之前先导出 DSL 备份**——改坏了能恢复
:::

小林把这套流程写成了一页纸的内部文档，发到团队群里。

做出来只是开始，持续盯着数据、不断调优，工具才能真的好用。

# 第 6 章：条件分支——让 AI 学会分类

> TechStore 客服的 Workflow 跑了几天，小林发现一个问题：
>
> 所有问题都用同样的方式处理——查知识库，然后回答。但有些问题明显需要不同的处理方式：
>
> - 客户问"你们有什么手机"→ 应该查**产品知识库**
> - 客户问"我要退货"→ 应该查**售后政策库**
> - 客户说"你们太差劲了"→ 应该用**安抚话术**，然后转人工
>
> "我需要让 AI 先判断这是什么类型的问题，再决定怎么处理。"
>
> 这就是条件分支的用途。

## 什么是条件分支

条件分支（IF/ELSE）是编程中最基础的逻辑结构：

```
如果（某个条件成立），那么（做 A）
否则（做 B）
```

在 Dify Workflow 中，条件分支节点让你可以根据不同的情况，让流程走向不同的路径。

想象一个十字路口：
- 直行：去往"产品咨询"处理流程
- 左转：去往"售后服务"处理流程
- 右转：去往"投诉处理"处理流程

条件分支就是这个十字路口的交通灯——根据"信号"决定走哪条路。

## 规划处理路径

在动手之前，先明确我们要实现的逻辑：

| 路径 | 判断条件 | 处理方式 |
|------|----------|----------|
| 产品咨询 | 问题包含产品关键词（手机、电脑、价格…） | 查产品知识库 |
| 售后服务 | 问题包含售后关键词（退货、换货、保修…） | 查 FAQ 知识库 |
| 投诉/其他 | 以上都不满足 | 安抚话术 + 转人工 |

## 第一步：添加条件分支节点

打开"TechStore 客服 v2"Workflow。

1. 在「开始」节点和「知识检索」节点之间，添加「条件分支」（IF/ELSE）节点
2. 把「开始」节点连接到「条件分支」节点
3. 点击「条件分支」节点，配置第一个条件（IF）：

**条件设置：**
- 变量：选择「开始 / user_question」
- 条件：包含
- 值：手机

点击「添加条件」，添加更多产品关键词（用"或者"连接）：
- 或者 包含：电脑
- 或者 包含：平板
- 或者 包含：价格
- 或者 包含：配置

## 第二步：添加 ELIF 分支

IF/ELSE 节点支持多个条件分支（ELIF）。

1. 在条件分支节点中，点击「添加分支」
2. 配置第二个条件（ELIF）：

- 变量：选择「开始 / user_question」
- 条件：包含
- 值：退货

添加更多售后关键词：
- 或者 包含：换货
- 或者 包含：保修
- 或者 包含：退款
- 或者 包含：维修

现在条件分支有三个出口：
- **IF**（产品咨询）
- **ELIF**（售后服务）
- **ELSE**（其他/投诉）

## 第三步：为每个分支配置处理流程

### IF 分支（产品咨询）

1. 添加「知识检索」节点，连接到 IF 出口
2. 配置查询「TechStore 产品知识库」（需要先创建这个知识库）
3. 添加「LLM」节点：

```
你是 TechStore 的产品顾问。请根据产品资料，回答客户的问题。
语气要专业但友好，可以适当推荐相关产品。

参考资料：
{{#context#}}
```

### ELIF 分支（售后服务）

1. 添加另一个「知识检索」节点，连接到 ELIF 出口
2. 配置查询「TechStore FAQ」知识库
3. 添加「LLM」节点：

```
你是 TechStore 的售后服务专员。请根据政策说明，回答客户的问题。
语气要耐心、专业，让客户感到被重视。

参考资料：
{{#context#}}
```

### ELSE 分支（其他/投诉）

1. 添加「LLM」节点，连接到 ELSE 出口
2. 不需要知识库，直接设置安抚话术：

```
你是 TechStore 的客服专员。客户的问题可能比较特殊或是投诉。
请用温和、理解的语气回应，表示会认真对待。
告诉客户："感谢您的反馈，您的问题已记录，我们的人工客服会尽快与您联系。"
```

## 第四步：汇总输出

三个分支都需要汇总到结束节点。

1. 把三个 LLM 节点都连接到「结束」节点
2. 在结束节点配置输出变量

Dify 会自动处理多个输入——哪个分支被执行，就输出哪个分支的结果。

现在的 Workflow 结构：

```
开始（接收问题）
    ↓
条件分支
    ├── IF（产品关键词）→ 产品知识库 → 产品顾问 LLM
    ├── ELIF（售后关键词）→ FAQ 知识库 → 售后专员 LLM
    └── ELSE（其他）→ 安抚话术 LLM
    ↓
结束（输出答案）
```

## 测试不同场景

**测试 1：产品咨询**
```
输入：你们有什么手机推荐吗？$500 左右的。
预期：走 IF 分支，查产品库，给出产品推荐
```

**测试 2：售后问题**
```
输入：我昨天买的耳机想退货，怎么操作？
预期：走 ELIF 分支，查 FAQ 库，给出退货流程
```

**测试 3：投诉**
```
输入：你们的快递太慢了，等了一个星期还没到！
预期：走 ELSE 分支，输出安抚话术
```

点击「运行」，分别测试这三个场景。观察 Workflow 的执行路径——你会看到不同的问题确实走了不同的分支。

---

小林测试完，满意地点点头：*"现在不同问题有不同的处理方式了。"*

## 进阶：使用 LLM 做分类

关键词匹配虽然简单，但有局限：
- 客户可能不用你预设的关键词
- 有些问题很难用关键词判断

更智能的方式是：**让 AI 来判断问题类型**。

Dify 提供了「问题分类器」节点：

1. 把条件分支节点替换成「问题分类器」节点
2. 定义分类：
   - 类别 1：产品咨询——询问产品信息、价格、功能、推荐
   - 类别 2：售后服务——退换货、保修、物流、退款
   - 类别 3：投诉建议——表达不满、提出批评、投诉问题
   - 类别 4：其他——以上都不属于
3. 配置模型（推荐用便宜的模型如 gpt-4o-mini）

问题分类器会用 AI 理解问题的意图，而不是简单匹配关键词。

比如"这手机怎么老是卡"——关键词匹配可能判断为产品咨询，但 AI 能理解这其实是投诉。

::: tip 权衡
- **关键词匹配**：速度快、成本低、但不够智能
- **AI 分类**：更智能、更准确、但会消耗更多 tokens

根据你的场景选择合适的方式。
:::

# 第 10 章：新场景——自动生成运营周报

> TechStore 的 AI 客服已经能独当一面了。小林终于可以从重复的客服咨询中解脱出来。
>
> 但他还有第二个痛点：**每周五下午的运营周报**。
>
> 每周都要：
> 1. 从各个系统收集数据（销售额、订单量、客诉数……）
> 2. 整理成表格
> 3. 写分析总结
> 4. 生成要发给老板的报告
>
> 这个过程至少要 3 个小时，而且非常枯燥。
>
> "能不能做一个 Workflow，把数据丢进去，自动生成周报？"
>
> 当然可以。

## 设计周报 Workflow

和客服场景不同，周报生成是一个"单次任务"——没有对话，输入数据，输出报告。

这正是 Workflow（而不是 Chatflow）的典型应用。

**设计思路：**

```
输入：本周销售数据 + 客诉数据 + 重要事件
  ↓
处理：数据解析 → 生成分析 → 生成总结 → 整合报告
  ↓
输出：结构化的周报文档
```

## 第一步：定义输入变量

创建新的 Workflow，命名为"TechStore 运营周报生成器"。

配置开始节点的输入变量：

| 变量名 | 类型 | 说明 |
|--------|------|------|
| `sales_data` | 长文本 | 本周销售数据 |
| `complaint_data` | 长文本 | 本周客诉汇总 |
| `key_events` | 长文本 | 本周重要事件（可选）|
| `week_range` | 文本 | 周报日期范围，如"2024.11.25-12.01"|

## 第二步：并行数据分析

周报需要分析两份独立的数据：销售数据和客诉数据。它们之间没有依赖关系，可以**并行执行**，节省一半的等待时间。

### 什么是并行处理

在 Dify 的 Workflow 中，当一个节点的输出同时连接到多个下游节点时，这些下游节点会**自动并行执行**。

实现方式非常简单：

1. 从「开始」节点拉出一条连线，连接到「销售分析」LLM 节点
2. 从「开始」节点再拉出一条连线，连接到「客诉分析」LLM 节点
3. 两个分析节点都完成后，再汇总到「周报生成」节点

```
            ┌── 销售分析 LLM ──┐
开始 ──┤                        ├── 周报生成 LLM → 结束
            └── 客诉分析 LLM ──┘
```

Dify 会自动识别这种结构，同时启动两个分析节点。当两个节点都执行完毕后，才会执行下游的「周报生成」节点。

::: tip 并行 vs 串行
- **串行**：销售分析（15秒）→ 客诉分析（15秒）= 总共 30 秒
- **并行**：销售分析 + 客诉分析同时进行 = 总共约 15 秒

节点越多，并行的优势越明显。只要节点之间没有数据依赖，就可以并行。
:::

### 配置销售分析节点

添加第一个 LLM 节点，命名为"销售分析"：

```
你是一位数据分析师。请分析以下销售数据，提取关键指标和洞察。

销售数据：
{{sales_data}}

请提取以下信息（如果数据中有的话）：
1. 总销售额及环比变化
2. 订单量及环比变化
3. 热销产品 TOP 5
4. 客单价变化
5. 值得关注的趋势或异常

以 JSON 格式输出，便于后续处理。
```

### 配置客诉分析节点

添加第二个 LLM 节点，命名为"客诉分析"：

```
你是一位客服质量分析师。请分析以下客诉数据。

客诉数据：
{{complaint_data}}

请提取以下信息：
1. 客诉总量及环比变化
2. 主要客诉类型分布
3. 典型问题案例
4. 需要改进的领域
5. 处理效率指标（如平均响应时间）

以结构化文本输出。
```

**别忘了**：这两个节点都直接连接到「开始」节点，不是串联的。

## 第三步：生成周报正文

添加第三个 LLM 节点，命名为"周报生成"。把前两个分析节点**都连接**到它。

配置输入：引用两个分析节点的输出。

```
你是 TechStore 的运营总监助理。请根据以下分析结果，撰写一份专业的运营周报。

日期范围：{{week_range}}

销售分析：
{{sales_analysis}}

客诉分析：
{{complaint_analysis}}

重要事件：
{{key_events}}

周报格式要求：

# TechStore 运营周报
## {{week_range}}

### 一、本周概览
（用 3-5 句话总结本周整体情况）

### 二、销售数据
（关键指标、趋势分析、亮点/问题）

### 三、客户服务
（客诉情况、处理效率、典型案例）

### 四、重要事件
（本周发生的重要事项）

### 五、下周重点
（基于本周数据，提出下周的工作重点）

语气要求：
- 专业、客观
- 数据说话，避免空洞描述
- 既报喜也报忧，问题要提解决方案
```

## 第四步：配置输出

1. 添加结束节点
2. 配置输出变量：`weekly_report` = 周报生成节点的输出

完整的 Workflow 结构：

```
            ┌── 销售分析 LLM ──┐
开始 ──┤                        ├── 周报生成 LLM → 结束
            └── 客诉分析 LLM ──┘
```

## 测试周报生成

**准备测试数据：**

`sales_data`:
```
本周销售汇总（11.25-12.01）
总销售额：1,258,600 元（上周：1,189,200 元，环比 +5.8%）
订单量：2,847 单（上周：2,756 单，环比 +3.3%）
客单价：442 元（上周：431 元，环比 +2.6%）

热销 TOP5：
1. TechPhone Pro 16 - 328 台 - 1,967,672 元
2. TechBuds Pro 3 - 412 副 - 535,188 元
3. TechBook Air 14 - 89 台 - 533,911 元
4. TechWatch Ultra - 156 只 - 467,844 元
5. TechPad Air 11 - 67 台 - 234,433 元
```

`complaint_data`:
```
本周客诉统计
总客诉：47 件（上周 52 件，下降 9.6%）
- 物流延迟：18 件（38%）
- 产品质量：12 件（26%）
- 退换货流程：9 件（19%）
- 售后服务态度：5 件（11%）
- 其他：3 件（6%）

平均响应时间：2.3 小时
解决率：91%
```

点击运行，观察执行过程——你会看到两个分析节点**同时开始执行**，都完成后才进入周报生成节点。

---

小林第一次用这个 Workflow 时，生成的周报只花了 **30 秒**。以前要 3 小时的工作，现在只需要把数据复制进去。

*"这才叫效率提升。"*

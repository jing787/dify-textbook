# 第 5 章：升级为 Workflow——相同功能，更多可能

> 小林决定把客服助手从 Chatbot 升级为 Workflow。
>
> "先实现和现在一样的功能，再逐步加强。"

## 创建 Workflow 应用

1. 工作室 → 创建空白应用
2. 选择应用类型：**Workflow**
3. 命名为"TechStore 客服 v2"
4. 点击创建

你会看到一个全新的界面——**Workflow 画布**。

## 认识 Workflow 画布

Workflow 画布是你设计 AI 应用的地方。几个核心概念：

**节点（Node）**：每个方块是一个节点，代表一个处理步骤。比如"LLM"节点调用大语言模型，"知识检索"节点查询知识库。

**连线（Edge）**：节点之间的连线表示数据流向。上一个节点的输出，会成为下一个节点的输入。

**开始节点**：每个 Workflow 都有一个开始节点，定义整个流程的输入。

**结束节点**：每个 Workflow 都有一个结束节点，定义整个流程的输出。

画布操作技巧：
- 滚轮缩放
- 拖拽移动画布
- 右键添加节点
- 从节点边缘拖出连线

## 第一步：配置开始节点

点击画布上的「开始」节点，在右侧面板配置输入：

**添加输入变量：**
- 变量名：`user_question`
- 类型：文本（String）
- 显示名称：用户问题
- 必填：是

这个变量就是用户输入的问题，整个 Workflow 的起点。

## 第二步：添加知识检索节点

1. 在画布空白处右键，选择「添加节点」→「知识检索」
2. 把「开始」节点连接到「知识检索」节点
3. 配置知识检索节点：

**查询变量**：选择「开始 / user_question」

**知识库**：选择"TechStore FAQ"

**检索设置**：
- 检索数量：5（返回最相关的 5 段内容）
- 相似度阈值：0.5（过滤掉相关性太低的结果）

这个节点会根据用户问题，从知识库中检索最相关的内容。

## 第三步：添加 LLM 节点

1. 添加「LLM」节点
2. 把「知识检索」节点连接到「LLM」节点
3. 配置 LLM 节点：

**选择模型**：gpt-3.5-turbo（或你配置的其他模型）

**System 提示词**：

```
你是 TechStore 的智能客服助手。

请根据以下参考资料，回答用户的问题。

参考资料：
{{#context#}}

回答要求：
1. 只根据参考资料回答，不要编造
2. 如果资料中没有相关信息，请说"这个问题我需要转给人工客服"
3. 语气友好、专业
4. 回答简洁，不超过 200 字
```

**User 提示词**：

```
{{user_question}}
```

::: tip 变量引用
- `{{#context#}}` 是知识检索节点的输出，包含检索到的相关内容
- `{{user_question}}` 是开始节点的输入变量
- 双大括号 `{{}}` 是 Dify 的变量引用语法
:::

## 第四步：配置结束节点

1. 把「LLM」节点连接到「结束」节点
2. 配置结束节点：

**添加输出变量**：
- 变量名：`answer`
- 变量值：选择「LLM / text」（LLM 节点的输出）

现在，整个 Workflow 的结构是：

```
开始（接收 user_question）
    ↓
知识检索（从知识库检索相关内容）
    ↓
LLM（根据检索内容生成回答）
    ↓
结束（输出 answer）
```

## 测试运行与调试

点击右上角的「运行」按钮，打开测试面板。

**输入**：
```
user_question: 退货流程是什么？
```

**点击运行**，观察执行过程。Dify 的调试面板会**实时显示**每个节点的执行状态——正在运行的节点会高亮，执行完的节点会显示绿色勾。

点击任意已完成的节点，可以看到它的输入和输出。比如点击「知识检索」节点，能看到它检索到了哪些段落；点击「LLM」节点，能看到完整的提示词（变量已被填入实际值）和生成的回答。

这个能力在 debug 时非常有用。如果最终回答不对，你不需要猜是哪一步出了问题——点开每个节点看一遍数据流，问题很快就能定位。比如知识检索返回的段落根本不相关，那问题出在检索配置；如果检索结果对了但回答不对，那问题出在 LLM 的提示词。

::: tip 单节点测试
如果你只想测某一个节点，不需要每次都从头跑整个 Workflow。Dify 支持对单个节点进行测试——点击节点右上角的测试按钮，手动填入输入值就能单独运行。这在 Workflow 变长之后特别省时间。
:::

## 对比 Chatbot 和 Workflow

现在这个 Workflow 的功能和之前的 Chatbot 完全一样。但有一个关键区别：

**Chatbot**：你只能配置提示词和知识库，内部流程是固定的。

**Workflow**：你可以自由添加、删除、重组节点，设计任意复杂的流程。

这为后续的升级打下了基础。

---

小林看着 Workflow 画布，开始有感觉了：

*"原来 AI 应用就是这样一步步搭起来的。"*

*"那如果我想让不同类型的问题走不同的流程……加个分叉？"*

没错，这就是下一章要讲的内容。

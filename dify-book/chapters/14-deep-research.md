# 第 14 章：综合实战——深度研究助手

> 小林的三个痛点都解决了。AI 客服、运营周报、内容工厂——这些工具已经成为 TechStore 日常运营的一部分。
>
> 一天，老板把小林叫到办公室。
>
> *"小林，听说你最近搞的那些 AI 工具很厉害？"*
>
> *"还行吧，主要是 Dify 好用。"*
>
> *"那我有个任务给你。"* 老板推过来一份文件，*"下个月董事会要讨论是否进入智能家居市场。我需要一份深度研究报告——市场规模、竞争格局、技术趋势、风险分析。你能用 AI 帮我做吗？"*
>
> 小林看了看文件，心想：这可比客服和周报复杂多了。
>
> *"我试试。"*

这一章，我们跟着小林一起，把前面学到的所有能力**组合起来**，构建一个真正复杂的应用——深度研究助手。

::: tip 为什么有这一章
前面的章节，每章重点学一个新能力——知识检索、条件分支、迭代、工具调用、模板转换……

这一章不教新节点，而是看看：**当这些能力组合在一起时，能做出什么**。

如果你跟到了这里，说明你已经掌握了 Dify 的核心能力。现在是检验的时候。
:::

## 分析需求

小林回到工位，开始思考这个任务。

一份好的研究报告需要什么？

1. **信息收集**：从多个渠道搜索相关信息
2. **信息筛选**：过滤掉广告、软文、过时内容
3. **信息整合**：把零散的信息组织成结构
4. **洞察分析**：不只是堆砌事实，还要有判断
5. **格式输出**：专业的报告格式

小林在纸上画了一个流程：

```
输入主题
    ↓
生成搜索关键词（不是一个，是一组）
    ↓
对每个关键词进行搜索
    ↓
从搜索结果中提取关键信息
    ↓
综合分析，形成洞察
    ↓
生成结构化报告
```

*"这里面有迭代（多个关键词），有工具调用（搜索），有多个 LLM 节点……"*

小林意识到，这会是他做过的最复杂的 Workflow。

*"但每一块我都学过。组合起来就是了。"*

## 用到的能力清单

| 能力 | 学习章节 | 在本章的用途 |
|------|----------|-------------|
| Workflow 基础 | 第 5 章 | 整体框架 |
| LLM 节点 | 第 5 章 | 搜索规划、信息提取、分析、报告撰写 |
| 迭代 | 第 7 章 | 遍历多个关键词搜索 |
| 工具调用 | 第 8 章 | DuckDuckGo 搜索 |
| 代码执行 | — | 解析 JSON |
| 模板转换 | 第 11 章 | 格式化最终报告 |

## 第一步：搜索规划

创建新的 Workflow，命名为"深度研究助手"。

**开始节点：**
- `topic`：研究主题（文本）
- `focus_areas`：重点关注领域（文本，可选）

**添加 LLM 节点——"搜索规划师"：**

```
你是一位资深的市场研究专家。请为以下研究主题制定搜索策略。

研究主题：{{topic}}
重点关注：{{focus_areas}}

请输出一个搜索计划，包含：
1. 5-8 个搜索关键词，要覆盖主题的不同维度
2. 每个关键词的搜索目的

以 JSON 格式输出：
{
  "keywords": [
    {"term": "关键词1", "purpose": "用于了解..."},
    {"term": "关键词2", "purpose": "用于了解..."}
  ]
}
```

**为什么要让 AI 生成关键词？**

如果小林自己想，可能只会搜"智能家居市场"。但 AI 会想到：
- "智能家居市场规模 2024"
- "小米 华为 智能家居 对比"
- "Matter 协议 智能家居"
- "智能家居 用户痛点"

多角度的搜索，才能得到全面的信息。

## 第二步：并行搜索

添加「代码执行」节点，解析 JSON 提取关键词数组。

添加「迭代」节点，遍历关键词数组。

**在迭代内部：**

1. **搜索工具节点**（如 DuckDuckGo）
   - 搜索词：`{{item}}`
   - 返回结果数：8

2. **LLM 节点——"信息提取员"**

```
请从以下搜索结果中提取与「{{topic}}」相关的关键信息。

搜索关键词：{{item}}
搜索结果：
{{search_results}}

提取规则：
1. 只保留有实质内容的信息（数据、事实、观点）
2. 忽略广告、软文、无关内容
3. 标注信息来源
4. 如果有具体数字，一定要保留

输出格式：
• [来源] 关键信息点
• [来源] 关键信息点
...

如果搜索结果中没有有价值的信息，请直接说"该关键词未找到有价值信息"。
```

迭代完成后，你会得到一个数组，每个元素是一个关键词的搜索提取结果。

## 第三步：综合分析

添加「LLM」节点——"首席分析师"：

```
你是一位资深的行业分析师。请基于以下收集到的信息，进行深度分析。

研究主题：{{topic}}
收集到的信息：
{{iteration_results}}

请完成以下分析任务：

【1. 关键发现】
提炼出 5-7 个最重要的发现，每个发现需要：
- 有明确的数据或事实支撑
- 说明其对研究主题的意义

【2. 市场格局】
- 市场规模和增长趋势
- 主要玩家及其定位
- 竞争态势

【3. 技术趋势】
- 当前主流技术方案
- 新兴技术方向
- 技术发展瓶颈

【4. 机会与风险】
- 市场机会点
- 潜在风险
- 进入壁垒

【5. 信息空白】
- 还需要补充哪些信息
- 建议进一步研究的方向

分析要求：
- 基于证据，不要臆测
- 不同来源的信息要交叉验证
- 如果信息有冲突，指出分歧
- 承认不确定性，不要过度解读
```

小林看着这个提示词，想起老板常说的：*"我要的不是信息堆砌，是洞察。"*

## 第四步：生成报告

添加「LLM」节点——"报告撰写员"：

```
请基于以下分析结果，撰写一份专业的研究报告。

分析结果：
{{analysis}}

报告格式：

# {{topic}} 研究报告

## 摘要
（150 字以内，核心结论）

## 一、研究背景与目的

## 二、市场概况
### 2.1 市场规模
### 2.2 增长趋势

## 三、竞争格局
### 3.1 主要玩家
### 3.2 竞争态势

## 四、技术发展
### 4.1 当前技术
### 4.2 未来方向

## 五、机会与挑战
### 5.1 市场机会
### 5.2 风险因素

## 六、结论与建议

## 附录：主要信息来源

---
报告生成时间：[当前时间]
```

## 测试与调优

**输入：**
```
topic: 中国新能源汽车市场竞争格局分析
focus_areas: 市场规模、主要玩家、技术趋势
```

点击运行，等待 2-3 分钟。

**运行过程：**
1. 搜索规划师生成了 6 个关键词
2. 迭代节点执行了 6 次搜索
3. 每次搜索提取了 5-10 条信息
4. 分析师综合了约 40 条信息
5. 报告撰写员生成了 3000+ 字的报告

小林看着生成的报告，有点意外：

*"居然还挺像那么回事的……有数据、有分析、有建议。"*

当然，AI 生成的报告不能直接用。小林还需要：
- 核实关键数据
- 补充内部视角
- 调整建议的可行性

但作为初稿，这已经节省了大量时间。

**以前做这样一份报告，可能要一周。现在，初稿 10 分钟就出来了。**

## 进阶：把子流程发布为工具

小林搭完这个 Workflow 之后发现，"搜索 + 信息提取"这段逻辑其实挺通用的——不只是研究报告需要，竞品分析、舆情监控、内容选题都可能用到。

每次都重新搭一遍太浪费了。Dify 提供了一个能力叫 **Workflow as Tool（把 Workflow 发布为工具）**：

1. 把"搜索 + 信息提取"的逻辑单独做成一个 Workflow
2. 在应用设置里选择「发布为工具」
3. 之后在任何其他 Workflow 或 Agent 里，都可以像调用搜索工具一样调用它

这就像写代码时把常用逻辑封装成函数——写一次，到处调用。深度研究助手调用它，竞品分析器也可以调用它，不用重复搭相同的节点。

---

小林把报告整理了一下，加上自己的判断，发给了老板。

第二天，老板回复：*"不错，比我预期的全面。继续深挖一下消费者洞察的部分。"*

小林笑了。这大概就是 AI 的正确用法——不是替代人，而是让人能做更多。
